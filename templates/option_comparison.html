<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Option Chain Visualizer</title>

    <!-- External libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <!-- Decoupled stylesheet -->
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
    <div id="loading">Loading Option Data...</div>

    <div class="app-container">

        <!-- ── Sidebar Controls ─────────────────────────────── -->
        <div class="sidebar">

            <!-- Exchange + Symbol selector -->
            <div>
                <h2>Market</h2>
                <div id="symbol-selector-container"></div>
            </div>

            <!-- Live toggle + date + time -->
            <div>
                <h2>
                    Controls
                    <div style="display:flex; align-items:center;">
                        <span class="live-label">Live</span>
                        <label class="switch">
                            <input type="checkbox" id="live-toggle">
                            <span class="slider-toggle"></span>
                        </label>
                    </div>
                </h2>

                <div class="control-group">
                    <label for="date-picker">Select Date:</label>
                    <input type="date" id="date-picker"
                        style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
                </div>

                <div class="control-group">
                    <label for="time-slider">
                        Spot Reference Time:
                        <span id="time-display"
                            style="font-weight:bold; color:var(--primary-color); margin-left:5px;">15:30</span>
                    </label>
                    <input type="range" id="time-slider" min="0" max="25" value="25" step="1" style="width:100%;">
                    <div style="display:flex; justify-content:space-between; font-size:10px; color:#666;">
                        <span>09:15</span><span>12:15</span><span>15:30</span>
                    </div>
                    <small style="color:#666; font-size:11px;">Slide to change strike selection time</small>
                </div>



                <div id="spot-price-display"
                    style="margin-top:10px; font-weight:bold; color:var(--primary-color); font-size:16px;"></div>
                <div id="expiry-date-display" style="font-size:14px; color:#555; margin-top:5px;"></div>
                <div id="last-updated" style="font-size:10px; color:#999; margin-top:2px;"></div>
            </div>

            <!-- Instrument selector -->
            <div>
                <h2>Instruments</h2>
                <div class="btn-group">
                    <button class="btn" onclick="selectInstruments('all')">All</button>
                    <button class="btn" onclick="selectInstruments('ce')">All CE</button>
                    <button class="btn" onclick="selectInstruments('pe')">All PE</button>
                    <button class="btn" onclick="selectInstruments('none')">Clear</button>
                </div>
                <div class="scrollable-list" id="instrument-list">
                    <!-- Populated by InstrumentSelector.js -->
                </div>
            </div>

            <!-- Metric checkboxes -->
            <div>
                <h2>Metrics (Criteria)</h2>
                <div class="control-group" id="metric-list">
                    <label><input type="checkbox" class="metric-cb" value="ltp" checked> LTP</label>
                    <label><input type="checkbox" class="metric-cb" value="change_in_ltp"> Change in LTP</label>
                    <label><input type="checkbox" class="metric-cb" value="roc_oi" checked> ROC OI (%)</label>
                    <label><input type="checkbox" class="metric-cb" value="roc_volume"> ROC Volume (%)</label>
                    <label><input type="checkbox" class="metric-cb" value="roc_iv"> ROC IV (%)</label>
                    <label><input type="checkbox" class="metric-cb" value="coi_vol_ratio"> COI/Vol Ratio</label>
                    <label><input type="checkbox" class="metric-cb" value="spot_price" checked> Spot Price</label>
                </div>
            </div>

            <button id="update-charts-btn" class="btn btn-primary"
                style="width:100%; padding:10px; margin-bottom:10px;">
                Update Charts
            </button>

            <button onclick="refreshToken()" class="btn"
                style="width:100%; padding:8px; font-size:11px; background:#f5f5f5; color:#666; border:1px dashed #ccc;">
                Refresh Token
            </button>
        </div>
        <!-- ── End Sidebar ──────────────────────────────────── -->

        <!-- ── Main Chart Area ──────────────────────────────── -->
        <div class="main-content" id="charts-area">
            <!-- Charts injected by ChartRenderer.js -->
        </div>
    </div>

    <!-- ── Decoupled JS — load order matters ─────────────────────────────── -->
    <!-- 1. Base component class -->
    <script src="/static/js/components/BaseComponent.js"></script>
    <!-- 2. Pure UI components -->
    <script src="/static/js/components/SymbolSelector.js"></script>
    <script src="/static/js/components/TimeSelector.js"></script>
    <script src="/static/js/components/InstrumentSelector.js"></script>
    <script src="/static/js/components/MetricSelector.js"></script>
    <script src="/static/js/components/ChartRenderer.js"></script>
    <!-- 3. Services (API + Data/Observer) -->
    <script src="/static/js/services/ApiService.js"></script>
    <script src="/static/js/services/DataService.js"></script>
    <!-- 4. Orchestrator — wires everything together -->
    <script src="/static/js/app.js"></script>
</body>

</html>